import"./style-BfgxKPfW.js";import{b as w,g as v,f as l,a as m,c as g}from"./products-data-CdHFDYeL.js";const S=document.getElementById("menu-button"),o=document.getElementById("menu"),u=document.getElementById("menu-overlay"),y=()=>{const i=!o.classList.contains("menu-closed");!i&&document.body.classList.contains("search-active")&&window.searchManager&&window.searchManager.deactivateSearch(),o.classList.toggle("menu-closed"),u.classList.toggle("menu-closed"),i||p(),i?document.body.style.overflow="":document.body.style.overflow="hidden"},p=()=>{const i=document.querySelector(".header-container");if(i){const t=i.getBoundingClientRect().bottom;o.style.top=`${t+8}px`}},h=()=>{o.classList.add("menu-closed"),u.classList.add("menu-closed"),o.style.top="",document.body.style.overflow=""};S.addEventListener("click",y);u.addEventListener("click",h);const f=document.querySelector(".header-container");f&&f.addEventListener("click",i=>{!i.target.closest("#menu-button")&&!o.classList.contains("menu-closed")&&h()});document.addEventListener("keydown",i=>{i.key==="Escape"&&!o.classList.contains("menu-closed")&&h()});document.addEventListener("scroll",()=>{o.classList.contains("menu-closed")||p()});window.addEventListener("resize",()=>{o.classList.contains("menu-closed")||p()});function E(i){const e=document.createElement("div");e.className="category-product-card";let t=`<span class="category-product-price-current">${l(i.price)}</span>`;return i.oldPrice&&(t+=`<span class="category-product-price-old">${l(i.oldPrice,"₽",!0)}</span>`),e.innerHTML=`
    <img src="${i.images[0]}" alt="${i.title}" />
    <div class="category-product-title">${i.title}</div>
    <div class="category-product-category">${i.category}</div>
    <div class="category-product-price">${t}</div>
  `,e.addEventListener("click",()=>{window.location.href=`product.html?product=${i.id}`}),e}function I(){const i=document.querySelector(".category-products-slider"),e=v();i.innerHTML="",e.forEach(t=>{const s=E(t);i.appendChild(s)}),setTimeout(()=>{i.scrollLeft=0},0)}function b(){const i=document.getElementById("categories-grid");i&&(i.innerHTML="",Object.values(g).forEach((e,t)=>{const s=L(e,t);i.appendChild(s)}))}function L(i,e){const t=document.createElement("div");return t.className="category-card",t.style.backgroundImage=`url(${i.image})`,e===Object.keys(g).length-1&&(t.style.gridColumn="span 2"),t.innerHTML=`
    <div class="category-card-content">
      <div class="category-card-title">${i.name}</div>
    </div>
  `,t.addEventListener("click",()=>{window.location.href=`category.html?category=${encodeURIComponent(i.name)}`}),t}class D{constructor(){this.slider=document.getElementById("bannerSlider"),this.bannerData=w,this.totalOriginalBanners=this.bannerData.length,this.extendedData=this.createExtendedData(),this.totalExtendedBanners=this.extendedData.length,this.startIndex=this.totalOriginalBanners,this.currentIndex=this.startIndex,this.gap=0,this.isTransitioning=!1,this.touchStartX=0,this.touchEndX=0,this.touchStartY=0,this.touchEndY=0,this.minSwipeDistance=50,this.isSwipeInProgress=!1,this.isMouseDown=!1,this.autoSlideInterval=null,this.autoSlideDelay=5e3,this.pauseDuration=1e4,this.pauseTimer=null,this.init()}createExtendedData(){return[...this.bannerData,...this.bannerData,...this.bannerData]}init(){this.renderBanners(),this.allBanners=Array.from(this.slider.querySelectorAll(".banner-item")),this.setPositionWithoutTransition(this.currentIndex),this.addEventListeners(),this.startAutoSlide(),this.initTouchEvents()}renderBanners(){this.slider.innerHTML="",this.extendedData.forEach((e,t)=>{const s=this.createBannerElement(e,t);this.slider.appendChild(s)})}createBannerElement(e,t){const s=document.createElement("div");s.className="banner-item",s.dataset.bannerId=e.id,s.dataset.extendedIndex=t;const n=t%this.totalOriginalBanners;return s.dataset.originalIndex=n,s.style.backgroundColor=e.backgroundColor,s.innerHTML=`
      <div class="banner-content">
        <h3>${e.title}</h3>
        <p>${e.subtitle}</p>
      </div>
    `,s}addEventListeners(){this.allBanners.forEach((e,t)=>{e.addEventListener("click",()=>{const s=e.classList.contains("active"),n=parseInt(e.dataset.originalIndex);s?this.handleBannerClick(n):this.setActive(t,!0)})})}handleBannerClick(e){const t=this.bannerData[e];if(t)switch(t.action){case"category":window.location.href=`category.html?category=${encodeURIComponent(t.actionParams.category)}`;break;case"product":window.location.href=`product.html?product=${t.actionParams.productId}`;break;case"url":window.location.href=t.actionParams.url;break;default:console.log("Неизвестное действие баннера:",t.action)}}setActive(e,t=!1){this.isTransitioning||(e<0&&(e=0),e>=this.totalExtendedBanners&&(e=this.totalExtendedBanners-1),e!==this.currentIndex&&(this.isTransitioning=!0,t&&this.pauseAutoSlide(),this.updateActiveClasses(e),this.animateToPosition(e),this.currentIndex=e,setTimeout(()=>{this.checkAndRewind(),this.isTransitioning=!1},350)))}setPositionWithoutTransition(e){this.slider.style.transition="none",this.updateActiveClasses(e),this.updateSliderPosition(e),this.currentIndex=e,requestAnimationFrame(()=>{this.slider.style.transition="transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)"})}updateActiveClasses(e){this.allBanners.forEach((t,s)=>{t.classList.toggle("active",s===e)})}animateToPosition(e){this.slider.style.transition="transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)",this.updateSliderPosition(e)}updateSliderPosition(e){const t=this.slider.parentElement.offsetWidth,s=this.getBannerWidth(),n=(t-s)/2,r=e*(s+this.gap),a=n-r;this.slider.style.transform=`translateX(${a}px)`}checkAndRewind(){if(this.currentIndex<=this.totalOriginalBanners*.5||this.currentIndex>=this.totalOriginalBanners*2.5){const t=this.currentIndex%this.totalOriginalBanners,s=this.startIndex+t;this.setPositionWithoutTransition(s)}}getBannerWidth(){if(this.allBanners&&this.allBanners.length>0)return this.allBanners[0].offsetWidth;const e=window.innerWidth;return e<=375?Math.min(e-60,300):e<=768?Math.min(e-70,400):e>=1024?400:Math.min(e-80,350)}nextSlide(e=!1){this.setActive(this.currentIndex+1,e)}prevSlide(e=!1){this.setActive(this.currentIndex-1,e)}initTouchEvents(){const e=this.slider.parentElement;let t=null,s=!1;e.addEventListener("touchstart",n=>{this.touchStartX=n.touches[0].clientX,this.touchStartY=n.touches[0].clientY,t=null,s=!1},{passive:!0}),e.addEventListener("touchend",n=>{this.touchEndX=n.changedTouches[0].clientX,this.touchEndY=n.changedTouches[0].clientY,t==="horizontal"&&this.handleSwipe(),t=null,s=!1},{passive:!0}),this.allBanners.forEach(n=>{n.addEventListener("touchstart",r=>{this.touchStartX=r.touches[0].clientX,this.touchStartY=r.touches[0].clientY,this.isSwipeInProgress=!1,t=null,s=!1},{passive:!0}),n.addEventListener("touchend",r=>{if(this.touchEndX=r.changedTouches[0].clientX,this.touchEndY=r.changedTouches[0].clientY,t==="horizontal"){const a=Math.abs(this.touchStartX-this.touchEndX),c=Math.abs(this.touchStartY-this.touchEndY);a>c&&a>this.minSwipeDistance&&(this.isSwipeInProgress=!0,setTimeout(()=>{this.isSwipeInProgress=!1},100)),this.handleSwipe()}t=null,s=!1},{passive:!0}),n.addEventListener("touchmove",r=>{if(!this.touchStartX||!this.touchStartY)return;const a=r.touches[0],c=Math.abs(a.clientX-this.touchStartX),d=Math.abs(a.clientY-this.touchStartY);!s&&(c>10||d>10)&&(s=!0,c>d*1.5?t="horizontal":d>c*1.5&&(t="vertical")),t==="horizontal"&&r.preventDefault()},{passive:!1}),n.addEventListener("click",r=>{this.isSwipeInProgress&&(r.preventDefault(),r.stopPropagation())},{capture:!0})}),e.addEventListener("mousedown",n=>{this.touchStartX=n.clientX,this.isMouseDown=!0}),e.addEventListener("mouseup",n=>{this.touchEndX=n.clientX,this.isMouseDown=!1,this.handleSwipe()})}handleSwipe(){if(!this.touchStartX||!this.touchEndX)return;const e=this.touchStartX-this.touchEndX,t=this.touchStartY-this.touchEndY;Math.abs(e)>Math.abs(t)&&Math.abs(e)>this.minSwipeDistance&&(e>0?this.nextSlide(!0):this.prevSlide(!0)),this.touchStartX=null,this.touchEndX=null,this.touchStartY=null,this.touchEndY=null}startAutoSlide(){this.autoSlideInterval&&clearInterval(this.autoSlideInterval),this.autoSlideInterval=setInterval(()=>{this.isTransitioning||this.nextSlide(!1)},this.autoSlideDelay)}stopAutoSlide(){this.autoSlideInterval&&(clearInterval(this.autoSlideInterval),this.autoSlideInterval=null)}pauseAutoSlide(){this.stopAutoSlide(),this.pauseTimer&&clearTimeout(this.pauseTimer),this.pauseTimer=setTimeout(()=>{this.startAutoSlide()},this.pauseDuration)}updateOnResize(){this.updateSliderPosition(this.currentIndex)}destroy(){this.stopAutoSlide(),this.pauseTimer&&clearTimeout(this.pauseTimer)}}class k{constructor(){this.searchInput=document.getElementById("search-input"),this.searchDropdown=document.getElementById("search-dropdown"),this.products=v(),this.selectedIndex=-1,this.currentResults=[],this.searchTimeout=null,this.isSearchActive=!1,this.init()}init(){this.searchInput.addEventListener("input",s=>{this.handleInput(s.target.value)}),this.searchInput.addEventListener("keydown",s=>{this.handleKeydown(s)}),document.addEventListener("click",s=>{!s.target.closest(".search-container")&&!s.target.closest(".header-container")&&(this.hideDropdown(),this.isSearchActive&&this.deactivateSearch())}),this.searchInput.addEventListener("focus",()=>{o.classList.contains("menu-closed")||h(),this.activateSearch(),this.searchInput.value.trim()?this.handleInput(this.searchInput.value):this.showNoResults()});const e=document.getElementById("search-overlay");e&&e.addEventListener("click",()=>{this.deactivateSearch()});const t=document.querySelector(".header-container");t&&t.addEventListener("click",s=>{!s.target.closest(".search-container")&&this.isSearchActive&&this.deactivateSearch()}),document.addEventListener("wheel",s=>{if(this.isSearchActive){if(s.target.closest(".search-dropdown"))return;s.preventDefault(),this.deactivateSearch()}},{passive:!1}),document.addEventListener("touchmove",s=>{if(this.isSearchActive){if(s.target.closest(".search-dropdown"))return;s.preventDefault(),this.deactivateSearch()}},{passive:!1}),document.addEventListener("click",s=>{this.isSearchActive&&(s.target.closest(".header-container")||(s.preventDefault(),s.stopPropagation(),this.deactivateSearch()))},{capture:!0})}handleInput(e){clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.performSearch(e)},200)}performSearch(e){const t=e.trim().toLowerCase();if(t.length===0){this.hideDropdown();return}this.currentResults=this.products.filter(s=>s.title.toLowerCase().includes(t)||s.category.toLowerCase().includes(t)),this.selectedIndex=-1,this.showResults()}showResults(){if(this.currentResults.length===0){this.showNoResults();return}this.searchDropdown.innerHTML="",this.currentResults.forEach((e,t)=>{const s=this.createSuggestion(e,t);this.searchDropdown.appendChild(s)}),this.showDropdown()}createSuggestion(e,t){const s=document.createElement("div");return s.className="search-suggestion",s.dataset.index=t,s.innerHTML=`
      <img src="${e.images[0]}" alt="${e.title}" />
      <div class="search-suggestion-content">
        <div class="search-suggestion-title">${e.title}</div>
        <div class="search-suggestion-category">${e.category}</div>
      </div>
      <div class="search-suggestion-price">${l(e.price)}</div>
    `,s.addEventListener("click",()=>{this.selectProduct(e)}),s}showNoResults(){this.searchDropdown.innerHTML='<div class="no-results">Товары не найдены</div>',this.showDropdown();const e=this.searchDropdown.querySelector(".no-results");e&&(e.addEventListener("click",()=>{this.deactivateSearch()}),e.addEventListener("touchstart",t=>{t.preventDefault(),t.stopPropagation()},{passive:!1}),e.addEventListener("touchmove",t=>{t.preventDefault(),t.stopPropagation()},{passive:!1}),e.addEventListener("touchend",t=>{t.preventDefault(),t.stopPropagation()},{passive:!1}))}selectProduct(e){this.searchInput.value="",this.hideDropdown(),window.location.href=`product.html?product=${e.id}`}handleKeydown(e){if(this.currentResults.length!==0)switch(e.key){case"ArrowDown":e.preventDefault(),this.selectedIndex=Math.min(this.selectedIndex+1,this.currentResults.length-1),this.updateSelection();break;case"ArrowUp":e.preventDefault(),this.selectedIndex=Math.max(this.selectedIndex-1,-1),this.updateSelection();break;case"Enter":e.preventDefault(),this.selectedIndex>=0&&this.selectProduct(this.currentResults[this.selectedIndex]);break;case"Escape":this.deactivateSearch();break}}updateSelection(){const e=this.searchDropdown.querySelectorAll(".search-suggestion");if(e.forEach((t,s)=>{t.classList.toggle("selected",s===this.selectedIndex)}),this.selectedIndex>=0){const t=e[this.selectedIndex];t&&t.scrollIntoView({block:"nearest",behavior:"smooth"})}}showDropdown(){this.searchDropdown.classList.add("show"),this.searchDropdown.querySelector(".no-results")?(this.searchDropdown.style.overflow="hidden",this.searchDropdown.style.touchAction="none"):(this.searchDropdown.style.overflow="",this.searchDropdown.style.touchAction="")}hideDropdown(){this.searchDropdown.classList.remove("show"),this.selectedIndex=-1,this.searchDropdown.style.overflow="",this.searchDropdown.style.touchAction=""}activateSearch(){const e=document.getElementById("menu");e&&!e.classList.contains("menu-closed")&&h(),this.isSearchActive=!0,document.body.classList.add("search-active");const t=document.getElementById("search-overlay");t&&t.classList.add("show");const s=document.querySelector(".search-container");s&&s.classList.add("search-active")}deactivateSearch(){this.isSearchActive=!1,document.body.classList.remove("search-active");const e=document.getElementById("search-overlay");e&&e.classList.remove("show");const t=document.querySelector(".search-container");t&&t.classList.remove("search-active"),this.hideDropdown(),this.searchInput.value="",this.searchInput.blur()}}class C{constructor(){this.isMenuOpen=!1,this.isSearchOpen=!1,this.blockedElements=new Set,this.init()}init(){const e=document.getElementById("menu");e&&new MutationObserver(n=>{n.forEach(r=>{r.type==="attributes"&&r.attributeName==="class"&&(this.isMenuOpen=!e.classList.contains("menu-closed"),this.updateBlockState())})}).observe(e,{attributes:!0});const t=document.getElementById("search-dropdown");t&&new MutationObserver(n=>{n.forEach(r=>{r.type==="attributes"&&r.attributeName==="class"&&(this.isSearchOpen=t.classList.contains("show"),this.updateBlockState())})}).observe(t,{attributes:!0})}updateBlockState(){this.isMenuOpen||this.isSearchOpen?this.blockClicks():this.unblockClicks()}blockClicks(){document.querySelectorAll(".category-product-card, .category-card").forEach(t=>{this.blockedElements.has(t)||(t.style.pointerEvents="none",this.blockedElements.add(t))})}unblockClicks(){this.blockedElements.forEach(e=>{e.style.pointerEvents=""}),this.blockedElements.clear()}}class P{constructor(){this.switchesContainer=document.getElementById("ps-plus-switches"),this.productsContainer=document.getElementById("ps-plus-products-container"),!(!this.switchesContainer||!this.productsContainer)&&(this.slider=this.switchesContainer.querySelector(".toggle-switch-slider"),this.inputs=this.switchesContainer.querySelectorAll('input[type="radio"]'),this.psPlus={essential:{name:"Essential",image:"https://images.unsplash.com/photo-1493711662062-fa541adb3fc8?w=600&h=400&fit=crop&crop=center",prices:{"1-month":960,"2-months":1800,"3-months":2600}},extra:{name:"Extra",image:"https://images.unsplash.com/photo-1552820728-8b83bb6b773f?w=600&h=400&fit=crop&crop=center",prices:{"1-month":1350,"2-months":2500,"3-months":3600}},premium:{name:"Premium",image:"https://images.unsplash.com/photo-1511512578047-dfb367046420?w=600&h=400&fit=crop&crop=center",prices:{"1-month":1700,"2-months":3200,"3-months":4600}}},this.init())}init(){this.inputs.forEach((t,s)=>{t.addEventListener("change",()=>{t.checked&&(this.moveSlider(s),this.updateProductPrices(t.value))})});const e=this.switchesContainer.querySelector('input[type="radio"]:checked');if(e){const t=Array.from(this.inputs).indexOf(e);this.moveSlider(t),this.updateProductPrices(e.value)}this.renderProducts(),window.addEventListener("resize",()=>{const t=this.switchesContainer.querySelector('input[type="radio"]:checked');if(t){const s=Array.from(this.inputs).indexOf(t);this.moveSlider(s)}})}moveSlider(e){const r=(this.switchesContainer.offsetWidth-6)/3,a=e*r;this.slider.style.transform=`translateX(${a}px)`,this.slider.style.transition="transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)"}renderProducts(){this.productsContainer.innerHTML="",Object.entries(this.psPlus).forEach(([e,t])=>{const s=this.createProductCard(t,e);this.productsContainer.appendChild(s)})}createProductCard(e,t){const s=document.createElement("div");s.className="container product-sub",s.dataset.productKey=t;const n=this.switchesContainer.querySelector('input[type="radio"]:checked'),r=n?n.value:"1-month",a=e.prices[r];return s.innerHTML=`
      <img src="${e.image}" alt="${e.name}">
      <div>
        <div>${e.name}</div>
        <div class="product-price">${m(a)}</div>
      </div>
    `,s}updateProductPrices(e){this.productsContainer.querySelectorAll(".product-sub").forEach(s=>{const n=s.dataset.productKey,r=this.psPlus[n];if(r){const a=s.querySelector(".product-price");if(a){const c=r.prices[e];a.innerHTML=m(c)}}})}}document.addEventListener("DOMContentLoaded",()=>{const i=new D,e=new k;window.searchManager=e,new P,new C,I(),b(),setTimeout(()=>{const t=document.querySelector(".category-products-slider");t&&(t.scrollLeft=0)},100),window.addEventListener("resize",()=>{setTimeout(()=>{i.updateOnResize()},100)})});
