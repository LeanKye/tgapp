<!-- 08edd46d-6ac9-45c7-8820-786f8fad1767 9308fc66-8bfa-487a-bee0-01b8aa330ee4 -->
# План: фиксы поиска, морфинга, предзагрузки и навбара

### 1) Свайп по поисковику не должен открывать фокус

- Файлы: `src/main.js` (класс `SearchManager.init()`), `src/category.js` (`initSearch()`)
- Что сделать:
  - Убрать принудительный фокус на `pointerdown`/`touchstart` (функция наподобие `ensureTopAndFocus`).
  - Добавить fast-tap: фокусировать инпут только на `pointerup`, если движение меньше порога и время удержания короткое.
  - Оставить текущую логику на событие `focus` (открытие поиска) — оно сработает только по реальному тапу.

### 2) Скролл в дропдауне поиска не должен открывать карточку товара

- Файлы: `src/main.js` (создание элементов подсказок в менеджере поиска), `src/category.js` (`createSearchSuggestion()`)
- Что сделать:
  - Удалить/заменить обработчик `click` на подсказках: навигацию выполнять только в fast-tap по `pointerup` при отсутствии движения.
  - Ввести флаг `dragging` для `#search-dropdown`: при `scroll`/значимом `pointermove` игнорировать тап.
  - Убедиться, что при активном поиске показывается `#search-overlay` с высоким `z-index`, чтобы события не «пробивались» на карточки каталога.
  - В CSS для `#search-dropdown` оставить `touch-action: pan-y`, добавить `overscroll-behavior-y: contain` (чтобы скролл не уходил на страницу).

### 3) Навбар при открытом поиске должен быть невидим, без «подпрыгиваний»

- Файл: `src/style.css`
- Что сделать:
  - Добавить правило, скрывающее панель, не ломая компоновку:
```css
/* скрыть нижний бар при активном поиске, без сдвигов */
body.search-active .bottom-nav {
  visibility: hidden;
  opacity: 0;
  pointer-events: none;
}
```

  - Не использовать `display: none` и не менять `transform`.

### 4) Отключить предзагрузку страниц

- Файл: `src/telegram-webapp.js`
- Что сделать:
  - Сделать `schedulePrefetch()` no-op (ранний `return;`) либо удалить её вызовы, если где-то есть `app.schedulePrefetch()`.
  - Убедиться, что в HTML нет `<link rel="prefetch">` (оставляем `preconnect`/`dns-prefetch`).

### 5) Анимация морфинга «Добавить в корзину» не должна перезапускаться при смене периода/плана

- Файл: `src/product.js`
- Что сделать:
  - В `renderBuyOrControls(product, animate)` игнорировать ветку с `cart-morph-active`/анимацией, если контролы уже существуют или кнопка уже в состоянии `.morphed`.
  - Убедиться, что обработчики смены варианта/периода/плана вызывают только `refreshBuyControls(product)`, без `animate=true`.
  - `handleAddToCartFromProduct()` оставляем с анимацией только для первого перехода в состояние «в корзине».

### Проверки

- Проверить: свайп по полю поиска не открывает клавиатуру; тап — открывает.
- Прокрутка дропдауна не приводит к переходам; быстрый тап — переходит.
- При активном поиске нижний бар не виден на всех страницах; без «скачков».
- Переходы между страницами — без префетча.
- Переключение периода/плана не перезапускает морфинг.

### To-dos

- [ ] Убрать автофокус на свайпе и добавить fast-tap фокус для поиска
- [ ] Заменить click на fast-tap и подавить переходы при скролле дропдауна
- [ ] Скрывать нижний навбар при активном поиске без сдвигов
- [ ] Отключить schedulePrefetch и очистить префетчи
- [ ] Защитить морфинг от перезапуска при смене вариантов