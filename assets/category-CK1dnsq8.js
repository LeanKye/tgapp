import"./style-CqyL8Gch.js";import{f as i,c as h,d as u}from"./products-data-CdHFDYeL.js";class m{constructor(){this.currentCategory=null,this.currentProducts=[],this.filteredProducts=[],this.init()}init(){const e=new URLSearchParams(window.location.search);if(this.currentCategory=e.get("category"),!this.currentCategory){window.location.href="index.html";return}this.initMenu(),this.initSearch(),this.loadCategoryData()}initMenu(){const e=document.getElementById("menu-button");this.menu=document.getElementById("menu");const t=document.getElementById("menu-overlay"),s=()=>{const n=document.querySelector(".header-container");if(n){const l=n.getBoundingClientRect().bottom;this.menu.style.top=`${l+8}px`}},o=()=>{const n=!this.menu.classList.contains("menu-closed");!n&&this.isSearchActive&&this.deactivateSearch(),this.menu.classList.toggle("menu-closed"),t.classList.toggle("menu-closed"),n||s(),n?document.body.style.overflow="":document.body.style.overflow="hidden"};this.closeMenu=()=>{this.menu.classList.add("menu-closed"),t.classList.add("menu-closed"),this.menu.style.top="",document.body.style.overflow=""},e&&e.addEventListener("click",o),t&&t.addEventListener("click",this.closeMenu);const c=document.querySelector(".header-container");c&&c.addEventListener("click",n=>{!n.target.closest("#menu-button")&&!this.menu.classList.contains("menu-closed")&&this.closeMenu()}),document.addEventListener("keydown",n=>{n.key==="Escape"&&!this.menu.classList.contains("menu-closed")&&this.closeMenu()}),document.addEventListener("scroll",()=>{this.menu.classList.contains("menu-closed")||s()}),window.addEventListener("resize",()=>{this.menu.classList.contains("menu-closed")||s()}),document.querySelectorAll(".menu-item[data-category]").forEach(n=>{n.addEventListener("click",()=>{const a=n.getAttribute("data-category");a===this.currentCategory?this.closeMenu():window.location.href=`category.html?category=${encodeURIComponent(a)}`})})}initSearch(){const e=document.getElementById("search-input");if(document.getElementById("search-dropdown"),!e)return;let t;this.isSearchActive=!1,e.addEventListener("input",c=>{clearTimeout(t);const r=c.target.value.trim();t=setTimeout(()=>{r.length===0?this.hideSearchDropdown():this.performSearch(r)},300)}),e.addEventListener("focus",()=>{this.activateSearch()}),document.addEventListener("click",c=>{!c.target.closest(".search-container")&&!c.target.closest(".header-container")&&(this.hideSearchDropdown(),this.isSearchActive&&this.deactivateSearch())});const s=document.getElementById("search-overlay");s&&s.addEventListener("click",()=>{this.deactivateSearch()});const o=document.querySelector(".header-container");o&&o.addEventListener("click",c=>{!c.target.closest(".search-container")&&this.isSearchActive&&this.deactivateSearch()}),document.addEventListener("wheel",c=>{if(this.isSearchActive){if(c.target.closest(".search-dropdown"))return;c.preventDefault(),this.deactivateSearch()}},{passive:!1}),document.addEventListener("touchmove",c=>{if(this.isSearchActive){if(c.target.closest(".search-dropdown"))return;c.preventDefault(),this.deactivateSearch()}},{passive:!1}),document.addEventListener("click",c=>{this.isSearchActive&&(c.target.closest(".header-container")||(c.preventDefault(),c.stopPropagation(),this.deactivateSearch()))},{capture:!0})}performSearch(e){const t=this.currentProducts.filter(s=>s.title.toLowerCase().includes(e.toLowerCase())||s.category.toLowerCase().includes(e.toLowerCase()));this.filteredProducts=t,t.length>0?this.showSearchDropdown(t.slice(0,5)):this.showNoSearchResults()}showSearchDropdown(e){const t=document.getElementById("search-dropdown");t&&(t.innerHTML="",e.forEach(s=>{const o=this.createSearchSuggestion(s);t.appendChild(o)}),t.classList.add("show"),t.style.overflow="",t.style.touchAction="")}createSearchSuggestion(e){const t=document.createElement("div");t.className="search-suggestion";let s=`<span class="search-suggestion-price">${i(e.price)}</span>`;return e.oldPrice&&(s=`<span class="search-suggestion-price">${i(e.price)} <span class="category-product-price-old">${i(e.oldPrice,"₽",!0)}</span></span>`),t.innerHTML=`
      <img src="${e.images[0]}" alt="${e.title}" />
      <div class="search-suggestion-content">
        <div class="search-suggestion-title">${e.title}</div>
        <div class="search-suggestion-category">${e.category}</div>
        ${s}
      </div>
    `,t.addEventListener("click",()=>{window.location.href=`product.html?product=${e.id}`}),t}showNoSearchResults(){const e=document.getElementById("search-dropdown");if(!e)return;e.innerHTML='<div class="no-results">Товары не найдены</div>',e.classList.add("show"),e.style.overflow="hidden",e.style.touchAction="none";const t=e.querySelector(".no-results");t&&(t.addEventListener("click",()=>{this.deactivateSearch()}),t.addEventListener("touchstart",s=>{s.preventDefault(),s.stopPropagation()},{passive:!1}),t.addEventListener("touchmove",s=>{s.preventDefault(),s.stopPropagation()},{passive:!1}),t.addEventListener("touchend",s=>{s.preventDefault(),s.stopPropagation()},{passive:!1}))}hideSearchDropdown(){const e=document.getElementById("search-dropdown");e&&(e.classList.remove("show"),e.style.overflow="",e.style.touchAction="")}activateSearch(){this.menu&&!this.menu.classList.contains("menu-closed")&&this.closeMenu(),this.isSearchActive=!0,document.body.classList.add("search-active");const e=document.getElementById("search-overlay");e&&e.classList.add("show");const t=document.querySelector(".search-container");t&&t.classList.add("search-active")}deactivateSearch(){this.isSearchActive=!1,document.body.classList.remove("search-active");const e=document.getElementById("search-overlay");e&&e.classList.remove("show");const t=document.querySelector(".search-container");t&&t.classList.remove("search-active"),this.hideSearchDropdown();const s=document.getElementById("search-input");s&&(s.value="",s.blur()),this.displayProducts(this.currentProducts)}showAllProducts(){this.displayProducts(this.currentProducts)}loadCategoryData(){const e=h[this.currentCategory];if(!e){window.location.href="index.html";return}document.title=`${e.name} - App`;const t=document.getElementById("category-title");t&&(t.textContent=e.name),this.currentProducts=u(this.currentCategory),this.displayProducts(this.currentProducts)}displayProducts(e){const t=document.getElementById("category-products"),s=document.getElementById("no-products");if(t){if(t.innerHTML="",e.length===0){s&&(s.style.display="block");return}s&&(s.style.display="none"),e.forEach(o=>{const c=this.createProductCard(o);t.appendChild(c)})}}createProductCard(e){const t=document.createElement("div");t.className="category-product-card";let s=`<span class="category-product-price-current">${i(e.price)}</span>`;return e.oldPrice&&(s+=`<span class="category-product-price-old">${i(e.oldPrice,"₽",!0)}</span>`),t.innerHTML=`
      <img src="${e.images[0]}" alt="${e.title}" />
      <div class="category-product-title">${e.title}</div>
      <div class="category-product-category">${e.category}</div>
      <div class="category-product-price">${s}</div>
    `,t.addEventListener("click",()=>{window.location.href=`product.html?product=${e.id}`}),t}}class v{constructor(){this.isMenuOpen=!1,this.isSearchOpen=!1,this.blockedElements=new Set,this.init()}init(){const e=document.getElementById("menu");e&&new MutationObserver(o=>{o.forEach(c=>{c.type==="attributes"&&c.attributeName==="class"&&(this.isMenuOpen=!e.classList.contains("menu-closed"),this.updateBlockState())})}).observe(e,{attributes:!0});const t=document.getElementById("search-dropdown");t&&new MutationObserver(o=>{o.forEach(c=>{c.type==="attributes"&&c.attributeName==="class"&&(this.isSearchOpen=t.classList.contains("show"),this.updateBlockState())})}).observe(t,{attributes:!0})}updateBlockState(){this.isMenuOpen||this.isSearchOpen?this.blockClicks():this.unblockClicks()}blockClicks(){document.querySelectorAll(".category-product-card, .category-card").forEach(t=>{this.blockedElements.has(t)||(t.style.pointerEvents="none",this.blockedElements.add(t))})}unblockClicks(){this.blockedElements.forEach(e=>{e.style.pointerEvents=""}),this.blockedElements.clear()}}document.addEventListener("DOMContentLoaded",()=>{new m,new v});
